# GenAI-3-24 (Генератор описаний изображений (эмоциональные, ≥40 слов, целые предложения))

Этот набор скриптов генерирует развёрнутые эмоциональные описания изображений на русском языке (минимум 40 слов). Описание состоит из цельных предложений — скрипты не обрезают предложения посреди. Результат сохраняется в текущую рабочую директорию как description_1.json, description_2.json и т.д.

Код модульный: main.py — точка входа, model_interface.py — взаимодействие с моделью, processor.py — минимальная постобработка, generator.py — загрузка и вызов модели (имеется в проекте).

## Файловая структура
```
project/
├─ main.py                 # точка входа, CLI
├─ model_interface.py      # промпт + вызов генерации (wrapper для generator.py)
├─ processor.py            # постобработка: целые предложения, минимум 40 слов
├─ generator.py            # (существующий) инициализация transformers pipeline и генерация текста
├─ requirements.txt        # зависимости
└─ README.md
```

## Модули
### generator.py
Файл-основа реализации из [GenAI-1-17](https://github.com/Kata9872/GenAI-1-17)
- ```initialize_generator(model)``` - Создание pipeline генерации текста с указанной моделью
- ```chat_prompt(prompt)``` - Форматирование текстового запроса в формат чата для инструктивных моделей
- ```def generate_text(generator, messages, max_new_tokens, do_sample, temperature, top_p, repetition_penalty)``` - Генерация текста с заданными параметрами

### model_interface.py
Адаптер/промптер для текущего pipeline
- Формирует промпт, который просит модель вернуть эмоциональное, полное описание, не короче 40 слов, состоящее из цельных предложений.
- Вызывает generator.generate_text(...) с контролируемыми параметрами (temperature, top_p, max_new_tokens и т.д.).
- Возвращает сырой выход модели (строку).

### processor.py
Минимальная постобработка (чтобы гарантировать требования)
- Разбивает модельный вывод на предложения (по . ! ?) и выбирает последовательность целых предложений так, чтобы:
1) итог ≥ 40 слов (при необходимости добавляет полные filler-предложения)
2) предложения не обрывались посреди,
3) при превышении мягкого лимита (MAX_WORDS, по умолчанию 50) не режет предложение посреди — либо оставляет длинное первое предложение.
- Возвращает единую строку — итоговое описание (эмоция встроена в текст).

### main.py
CLI точка входа
Опции:
--desc — обязательный аргумент (строка с коротким описанием или путь к файлу со списком описаний, одна строка на описание).
--model — имя модели (по умолчанию Qwen/Qwen2-1.5B-Instruct).
--out — путь к папке для сохранения JSON (по умолчанию . — текущая рабочая папка).
1) Инициализирует генератор (model_interface.get_generator).
2) Для каждого описания генерирует сырой текст (generate_raw_text).
3) Обрабатывает вывод (processor.make_final_description) — получаем описание ≥40 слов, целые предложения, эмоциональность встроена.
Сохраняет JSON с полями:
```
{
  "short_description": "<короткое описание>",
  "description": "<финальное эмоциональное описание (строка)>"
}
```

## Установка (рекомендовано: виртуальное окружение)

### Linux / macOS
```bash
# создать venv и активировать
python3 -m venv .venv
source .venv/bin/activate

# обновить pip и установить зависимости
python -m pip install --upgrade pip
pip install -r requirements.txt
```
### Windows

```bash
python -m venv .venv
.\.venv\Scripts\Activate.ps1
python -m pip install --upgrade pip
pip install -r requirements.txt
```

## Примеры использования

```bash
python main.py --desc "кошка на диване"
```
